<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>公司會議室預約系統</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; background-color: #f3f4f6; }
        .animate-fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- Firebase SDK Setup -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, deleteDoc, doc, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // =================================================================
        // Firebase Config
        // =================================================================
        const firebaseConfig = {
            apiKey: "AIzaSyAfFP7Jh3szlz9tmba6EckBQGTu74laG4U",
            authDomain: "qpc-meeting-room-app.firebaseapp.com",
            projectId: "qpc-meeting-room-app",
            storageBucket: "qpc-meeting-room-app.firebasestorage.app",
            messagingSenderId: "327977284406",
            appId: "1:327977284406:web:d26380a5b4523d9220f997"
        };
        
        // 檢查是否已設定 Config
        const isFirebaseConfigured = firebaseConfig.projectId !== "your-project-id";
        
        let db;
        if (isFirebaseConfigured) {
            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                console.log("Firebase initialized");
            } catch (error) {
                console.error("Firebase Initialization Error:", error);
            }
        } else {
            console.log("Running in Local Demo Mode (No Firebase Config detected)");
        }

        // Expose to window for React
        window.isFirebaseConfigured = isFirebaseConfigured;
        window.db = db;
        window.fs = { collection, addDoc, onSnapshot, deleteDoc, doc, query, orderBy };
    </script>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- Data Definitions ---
        const ROOMS = [
            { id: 'A101', name: 'A101 小會議室', building: '行政大樓', floor: '1F', type: 'small', capacity: 4 },
            { id: 'A201', name: 'A201 小會議室', building: '行政大樓', floor: '2F', type: 'small', capacity: 4 },
            { id: 'A202', name: 'A202 大會議室', building: '行政大樓', floor: '2F', type: 'large', capacity: 12 },
            { id: 'A301', name: 'A301 小會議室', building: '行政大樓', floor: '3F', type: 'small', capacity: 4 },
            { id: 'A302', name: 'A302 大會議室', building: '行政大樓', floor: '3F', type: 'large', capacity: 12 },
            { id: 'A401', name: 'A401 大會議室', building: '行政大樓', floor: '4F', type: 'large', capacity: 20 },
            { id: 'P201', name: 'P201 小會議室', building: '生產部大樓', floor: '2F', type: 'small', capacity: 6 },
            { id: 'P202', name: 'P202 大會議室', building: '生產部大樓', floor: '2F', type: 'large', capacity: 15 },
        ];

        // --- Icons ---
        const IconMapPin = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>;
        const IconUsers = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>;
        const IconCalendar = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>;
        const IconClock = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>;
        const IconPlus = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>;
        const IconTrash = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>;
        const IconCheck = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"/></svg>;
        const IconWifiOff = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="1" y1="1" x2="23" y2="23"/><path d="M16.72 11.06A10.94 10.94 0 0 1 19 12.55"/><path d="M5 12.55a10.94 10.94 0 0 1 5.17-2.39"/><path d="M10.71 5.05A16 16 0 0 1 22.58 9"/><path d="M1.42 9a15.91 15.91 0 0 1 4.7-2.88"/><path d="M8.53 16.11a6 6 0 0 1 6.95 0"/><line x1="12" y1="20" x2="12.01" y2="20"/></svg>;
        const IconWifi = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12.55a11 11 0 0 1 14.08 0"/><path d="M1.42 9a16 16 0 0 1 21.16 0"/><path d="M8.53 16.11a6 6 0 0 1 6.95 0"/><line x1="12" y1="20" x2="12.01" y2="20"/></svg>;
        const IconAlert = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y2="16"/></svg>;

        const getTodayString = () => new Date().toISOString().split('T')[0];
        const generateId = () => Math.random().toString(36).substr(2, 9);

        // --- Components ---
        const Modal = ({ isOpen, onClose, title, children }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4 animate-fade-in">
                    <div className="bg-white rounded-xl shadow-2xl w-full max-w-md overflow-hidden">
                        <div className="px-6 py-4 border-b border-gray-100 flex justify-between items-center bg-gray-50">
                            <h3 className="font-bold text-lg text-gray-800">{title}</h3>
                            <button onClick={onClose} className="text-gray-400 hover:text-gray-600 transition-colors">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="18" x2="6" y1="6" y2="18"/><line x1="6" x2="18" y1="6" y2="18"/></svg>
                            </button>
                        </div>
                        <div className="p-6">{children}</div>
                    </div>
                </div>
            );
        };

        const BookingForm = ({ room, date, onClose, onSave, existingBookings, isSaving }) => {
            const [formData, setFormData] = useState({
                department: '', booker: '', date: date || getTodayString(), startTime: '09:00', endTime: '10:00'
            });
            const [error, setError] = useState('');

            const handleChange = (e) => {
                setFormData({ ...formData, [e.target.name]: e.target.value });
                setError('');
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                if (formData.startTime >= formData.endTime) {
                    setError('結束時間必須晚於開始時間');
                    return;
                }
                const hasConflict = existingBookings.some(booking => {
                    if (booking.roomId !== room.id) return false;
                    if (booking.date !== formData.date) return false;
                    return (formData.startTime < booking.endTime && formData.endTime > booking.startTime);
                });

                if (hasConflict) {
                    setError('該時段已被預約，請選擇其他時間。');
                    return;
                }

                onSave({
                    id: generateId(), // For local mode
                    roomId: room.id,
                    roomName: room.name,
                    ...formData,
                    timestamp: new Date().toISOString()
                });
            };

            return (
                <form onSubmit={handleSubmit} className="space-y-4">
                    <div className="p-3 bg-blue-50 text-blue-800 rounded-lg text-sm mb-4">正在預約：<span className="font-bold">{room.name}</span></div>
                    <div><label className="block text-sm font-medium text-gray-700 mb-1">預約日期</label><input type="date" name="date" required className="w-full border border-gray-300 rounded-lg px-3 py-2 outline-none" value={formData.date} onChange={handleChange} /></div>
                    <div className="grid grid-cols-2 gap-4">
                        <div><label className="block text-sm font-medium text-gray-700 mb-1">開始時間</label><input type="time" name="startTime" required className="w-full border border-gray-300 rounded-lg px-3 py-2 outline-none" value={formData.startTime} onChange={handleChange} /></div>
                        <div><label className="block text-sm font-medium text-gray-700 mb-1">結束時間</label><input type="time" name="endTime" required className="w-full border border-gray-300 rounded-lg px-3 py-2 outline-none" value={formData.endTime} onChange={handleChange} /></div>
                    </div>
                    <div>
                        <label className="block text-sm font-medium text-gray-700 mb-1">部門</label>
                        <select name="department" required className="w-full border border-gray-300 rounded-lg px-3 py-2 outline-none" value={formData.department} onChange={handleChange}>
                            <option value="">請選擇部門</option>
                            <option value="行政部">行政部</option><option value="生產部">生產部</option><option value="業務部">業務部</option><option value="研發部">研發部</option><option value="人事部">人事部</option>
                        </select>
                    </div>
                    <div><label className="block text-sm font-medium text-gray-700 mb-1">預約人姓名</label><input type="text" name="booker" required placeholder="例如：王小明" className="w-full border border-gray-300 rounded-lg px-3 py-2 outline-none" value={formData.booker} onChange={handleChange} /></div>
                    {error && <div className="text-red-500 text-sm bg-red-50 p-2 rounded">{error}</div>}
                    <div className="pt-2">
                        <button type="submit" disabled={isSaving} className={`w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2.5 rounded-lg transition-colors flex justify-center items-center gap-2 ${isSaving ? 'opacity-50 cursor-not-allowed' : ''}`}>
                            {isSaving ? '處理中...' : <><IconCheck /> 確認預約</>}
                        </button>
                    </div>
                </form>
            );
        };

        const RoomCard = ({ room, onBook, dayBookings }) => {
            const sortedBookings = [...dayBookings].sort((a, b) => a.startTime.localeCompare(b.startTime));
            return (
                <div className="bg-white rounded-xl shadow-sm border border-gray-200 hover:shadow-md transition-shadow duration-200 overflow-hidden flex flex-col h-full">
                    <div className="p-5 border-b border-gray-100">
                        <div className="flex justify-between items-start mb-2">
                            <span className={`text-xs font-bold px-2 py-1 rounded-full ${room.building.includes('行政') ? 'bg-indigo-100 text-indigo-700' : 'bg-amber-100 text-amber-700'}`}>{room.building}</span>
                            <span className="text-gray-400 text-xs font-mono">{room.id}</span>
                        </div>
                        <h3 className="text-xl font-bold text-gray-800 mb-1">{room.name}</h3>
                        <div className="flex items-center gap-4 text-sm text-gray-500 mt-2">
                            <div className="flex items-center gap-1"><IconMapPin /> {room.floor}</div>
                            <div className="flex items-center gap-1"><IconUsers /> {room.capacity}人</div>
                        </div>
                    </div>
                    <div className="bg-gray-50 p-4 flex-grow">
                        <h4 className="text-xs font-semibold text-gray-500 uppercase mb-3">今日預約狀況</h4>
                        {sortedBookings.length === 0 ? <div className="text-center py-4 text-gray-400 text-sm">尚無預約，全日空閒</div> : 
                            <div className="space-y-2">
                                {sortedBookings.map(booking => (
                                    <div key={booking.id} className="bg-white px-3 py-2 rounded border border-gray-200 text-sm flex justify-between items-center shadow-sm">
                                        <div className="flex items-center gap-2 text-gray-700 font-medium"><span className="text-blue-600">{booking.startTime} - {booking.endTime}</span></div>
                                        <div className="text-xs text-gray-500">{booking.department} {booking.booker}</div>
                                    </div>
                                ))}
                            </div>
                        }
                    </div>
                    <div className="p-4 bg-white border-t border-gray-100">
                        <button onClick={() => onBook(room)} className="w-full bg-white border-2 border-blue-600 text-blue-600 hover:bg-blue-50 font-semibold py-2 rounded-lg transition-colors flex items-center justify-center gap-2">
                            <IconPlus /> 預約會議室
                        </button>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [view, setView] = useState('rooms');
            const [selectedDate, setSelectedDate] = useState(getTodayString());
            const [bookings, setBookings] = useState([]);
            const [bookingModal, setBookingModal] = useState({ isOpen: false, room: null });
            const [isSaving, setIsSaving] = useState(false);
            const [backendError, setBackendError] = useState(null);
            
            // Mode State: 'local' (localStorage) or 'firebase' (Online)
            const [mode, setMode] = useState('checking');

            // Initialize Mode
            useEffect(() => {
                if (window.isFirebaseConfigured && window.db) {
                    setMode('firebase');
                } else {
                    setMode('local');
                    // Load local data
                    const saved = localStorage.getItem('meeting_bookings');
                    if (saved) setBookings(JSON.parse(saved));
                }
            }, []);

            // Firebase Listener (Only if mode is firebase)
            useEffect(() => {
                if (mode !== 'firebase') return;

                const q = window.fs.query(window.fs.collection(window.db, "bookings"));
                const unsubscribe = window.fs.onSnapshot(q, (querySnapshot) => {
                    setBackendError(null); // Clear previous errors
                    const bookingsData = [];
                    querySnapshot.forEach((doc) => {
                        bookingsData.push({ id: doc.id, ...doc.data() });
                    });
                    setBookings(bookingsData);
                }, (error) => {
                    console.error("Firestore Error:", error);
                    
                    // Handle specific error for uninitialized DB
                    if (error.code === 'permission-denied' || error.message.includes('Cloud Firestore API')) {
                        setBackendError({
                            title: "資料庫尚未啟用",
                            message: "請前往 Firebase Console -> Build -> Firestore Database，點擊「Create database」並選擇「Start in test mode」。"
                        });
                        setMode('local'); // Fallback to local
                        // Load local data as fallback
                        const saved = localStorage.getItem('meeting_bookings');
                        if (saved) setBookings(JSON.parse(saved));
                    } else {
                        alert("無法連線到資料庫，請檢查 Firebase 設定或網路連線。");
                    }
                });

                return () => unsubscribe();
            }, [mode]);

            // Save Handler
            const handleSaveBooking = async (newBooking) => {
                setIsSaving(true);
                
                if (mode === 'local') {
                    // Local Save
                    const updatedBookings = [...bookings, newBooking];
                    setBookings(updatedBookings);
                    localStorage.setItem('meeting_bookings', JSON.stringify(updatedBookings));
                    setBookingModal({ isOpen: false, room: null });
                    alert('預約成功 (單機模式)');
                    setIsSaving(false);
                } else {
                    // Firebase Save
                    try {
                        // Remove 'id' if generated by frontend, let Firestore generate it
                        const { id, ...bookingData } = newBooking;
                        await window.fs.addDoc(window.fs.collection(window.db, "bookings"), bookingData);
                        setBookingModal({ isOpen: false, room: null });
                        alert('預約成功');
                    } catch (e) {
                        console.error("Error adding document: ", e);
                        alert("預約失敗，請檢查網路或資料庫設定");
                    }
                    setIsSaving(false);
                }
            };

            // Delete Handler
            const handleDeleteBooking = async (id) => {
                if(!confirm('確定要取消這個預約嗎？')) return;

                if (mode === 'local') {
                    // Local Delete
                    const updatedBookings = bookings.filter(b => b.id !== id);
                    setBookings(updatedBookings);
                    localStorage.setItem('meeting_bookings', JSON.stringify(updatedBookings));
                } else {
                    // Firebase Delete
                    try {
                        await window.fs.deleteDoc(window.fs.doc(window.db, "bookings", id));
                    } catch (e) {
                        console.error("Error deleting document: ", e);
                        alert("刪除失敗");
                    }
                }
            };

            const currentDayBookings = useMemo(() => bookings.filter(b => b.date === selectedDate), [bookings, selectedDate]);
            const bookingsByRoom = useMemo(() => {
                const map = {};
                currentDayBookings.forEach(b => {
                    if (!map[b.roomId]) map[b.roomId] = [];
                    map[b.roomId].push(b);
                });
                return map;
            }, [currentDayBookings]);

            return (
                <div className="min-h-screen pb-10">
                    <header className="bg-white shadow-sm sticky top-0 z-10">
                        <div className="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
                            <div className="flex items-center gap-2">
                                <div className="bg-blue-600 text-white p-1.5 rounded-lg"><IconCalendar /></div>
                                <h1 className="text-xl font-bold text-gray-800 tracking-tight">會議室預約系統</h1>
                            </div>
                            <nav className="flex gap-4">
                                <button onClick={() => setView('rooms')} className={`px-3 py-2 rounded-md text-sm font-medium transition-colors ${view === 'rooms' ? 'bg-blue-50 text-blue-700' : 'text-gray-500 hover:text-gray-700'}`}>會議室總覽</button>
                                <button onClick={() => setView('my-bookings')} className={`px-3 py-2 rounded-md text-sm font-medium transition-colors ${view === 'my-bookings' ? 'bg-blue-50 text-blue-700' : 'text-gray-500 hover:text-gray-700'}`}>預約管理列表</button>
                            </nav>
                        </div>
                    </header>

                    <main className="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                        {/* Backend Error Banner (Critical Actions Needed) */}
                        {backendError && (
                            <div className="bg-red-50 border-l-4 border-red-500 p-4 mb-6 rounded-r shadow-sm">
                                <div className="flex gap-3">
                                    <div className="text-red-500 mt-1"><IconAlert /></div>
                                    <div>
                                        <p className="font-bold text-red-800">{backendError.title}</p>
                                        <p className="text-sm text-red-700 mb-2">{backendError.message}</p>
                                        <div className="text-xs text-red-600 bg-red-100 p-2 rounded inline-block">
                                            系統已自動切換至「單機模式」以維持運作，修正後請重新整理網頁。
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Status Banner */}
                        {mode === 'local' && !backendError && (
                            <div className="bg-amber-50 border-l-4 border-amber-400 p-4 mb-6 rounded-r shadow-sm flex justify-between items-start">
                                <div className="flex gap-3">
                                    <div className="text-amber-500 mt-1"><IconWifiOff /></div>
                                    <div>
                                        <p className="font-bold text-amber-800">目前為「單機測試模式」</p>
                                        <p className="text-sm text-amber-700">資料僅儲存於此瀏覽器，不會與他人同步。若要啟用多人連線，請修改程式碼中的 <code>firebaseConfig</code>。</p>
                                    </div>
                                </div>
                            </div>
                        )}
                        
                        {mode === 'firebase' && (
                            <div className="bg-green-50 border-l-4 border-green-400 p-4 mb-6 rounded-r shadow-sm flex justify-between items-start">
                                <div className="flex gap-3">
                                    <div className="text-green-500 mt-1"><IconWifi /></div>
                                    <div>
                                        <p className="font-bold text-green-800">已連線至資料庫</p>
                                        <p className="text-sm text-green-700">您所做的變更將即時同步給所有使用者。</p>
                                    </div>
                                </div>
                            </div>
                        )}

                        {view === 'rooms' && (
                            <div className="mb-8 bg-white p-4 rounded-xl shadow-sm flex flex-col sm:flex-row items-center justify-between gap-4">
                                <div className="flex items-center gap-2 text-gray-700 font-medium"><span className="bg-gray-100 p-2 rounded-full"><IconClock /></span><span>查看預約狀況：</span></div>
                                <input type="date" value={selectedDate} onChange={(e) => setSelectedDate(e.target.value)} className="border border-gray-300 rounded-lg px-4 py-2 w-full sm:w-auto outline-none font-sans" />
                            </div>
                        )}

                        {view === 'rooms' && (
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 animate-fade-in">
                                {ROOMS.map(room => (
                                    <RoomCard key={room.id} room={room} dayBookings={bookingsByRoom[room.id] || []} onBook={(r) => setBookingModal({ isOpen: true, room: r })} />
                                ))}
                            </div>
                        )}

                        {view === 'my-bookings' && (
                            <div className="bg-white rounded-xl shadow-sm overflow-hidden animate-fade-in">
                                <div className="px-6 py-4 border-b border-gray-100 bg-gray-50 flex justify-between items-center">
                                    <h2 className="font-bold text-gray-700">所有預約紀錄</h2>
                                    <span className="text-xs px-2 py-1 rounded bg-gray-200 text-gray-600">{mode === 'local' ? '儲存於本機' : '雲端同步中'}</span>
                                </div>
                                {bookings.length === 0 ? <div className="p-10 text-center text-gray-500">目前沒有任何預約紀錄。</div> : 
                                    <div className="overflow-x-auto">
                                        <table className="w-full text-left text-sm text-gray-600">
                                            <thead className="bg-gray-50 text-xs uppercase font-semibold text-gray-500">
                                                <tr><th className="px-6 py-3">日期</th><th className="px-6 py-3">時間</th><th className="px-6 py-3">會議室</th><th className="px-6 py-3">部門/人員</th><th className="px-6 py-3 text-right">操作</th></tr>
                                            </thead>
                                            <tbody className="divide-y divide-gray-100">
                                                {[...bookings].sort((a,b) => b.date.localeCompare(a.date) || b.startTime.localeCompare(a.startTime)).map(booking => (
                                                    <tr key={booking.id} className="hover:bg-gray-50 transition-colors">
                                                        <td className="px-6 py-3 font-medium text-gray-800">{booking.date}</td>
                                                        <td className="px-6 py-3">{booking.startTime} - {booking.endTime}</td>
                                                        <td className="px-6 py-3"><span className="font-medium text-blue-600">{booking.roomName}</span></td>
                                                        <td className="px-6 py-3"><div className="flex flex-col"><span>{booking.department}</span><span className="text-xs text-gray-400">{booking.booker}</span></div></td>
                                                        <td className="px-6 py-3 text-right">
                                                            <button onClick={() => handleDeleteBooking(booking.id)} className="text-red-500 hover:text-red-700 bg-red-50 hover:bg-red-100 p-2 rounded transition-colors" title="取消預約"><IconTrash /></button>
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                }
                            </div>
                        )}
                    </main>

                    <Modal isOpen={bookingModal.isOpen} onClose={() => setBookingModal({ isOpen: false, room: null })} title="預約會議室">
                        {bookingModal.room && <BookingForm room={bookingModal.room} date={selectedDate} existingBookings={bookings} onClose={() => setBookingModal({ isOpen: false, room: null })} onSave={handleSaveBooking} isSaving={isSaving} />}
                    </Modal>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
